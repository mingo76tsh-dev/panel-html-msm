<!doctype html>
<html lang="es" dir="ltr">
<head>
  <!-- ===== META / PWA / SEO ===== -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="dark light" />
  <meta name="theme-color" content="#0b1220" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="description" content="HS-V7 — Panel Salud Mental: registro de ingresos/altas con soporte offline, pendientes y PWA." />
  <title>HS-V7 — Panel Salud Mental</title>

  <!-- Manifest + iconos (rutas absolutas para GH Pages bajo /panel-html-msm/) -->
  <link rel="manifest" href="/panel-html-msm/manifest.json" />
  <link rel="icon" type="image/png" sizes="32x32" href="/panel-html-msm/ICONS/favicon-32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/panel-html-msm/ICONS/favicon-16.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/panel-html-msm/ICONS/icon-192.png" />

  <!-- Preconexión (si usás Apps Script / APIs) -->
  <link rel="preconnect" href="https://script.google.com" crossorigin>
  <link rel="preconnect" href="https://script.googleapis.com" crossorigin>

  <!-- ===== ESTILOS MÍNIMOS (no tocan tu UI) ===== -->
  <style>
    :root{
      --bg:#0b1220;--ink:#e5e7eb;--card:#0f172a;--muted:#94a3b8;--ok:#10b981;--ring:#1e293b;
    }
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.45 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .wrap{max-width:1024px;margin:0 auto;padding:16px}
    .appbar{display:flex;gap:12px;align-items:center;background:var(--card);border-radius:14px;padding:14px 16px;position:sticky;top:0}
    .appbar img{width:40px;height:40px;border-radius:9px}
    .chip{background:#052b33;color:#8ef0c7;border:1px solid #0d3b46;border-radius:999px;padding:2px 10px;font-size:12px}
    .title{font-weight:600;margin:0}
    .visually-hidden{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden}
    .toast{position:fixed;inset:auto 12px 12px;min-width:220px;background:#0a1a2b;color:var(--ink);border:1px solid var(--ring);border-radius:12px;padding:10px 12px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  </style>
</head>
<body>
  <noscript>⚠️ Para usar esta app necesitás habilitar JavaScript.</noscript>
  <a class="visually-hidden" href="#main">Saltar al contenido</a>

  <main id="main" class="wrap" role="main">
    <!-- ===== APP BAR ===== -->
    <section class="appbar" aria-label="Encabezado de la aplicación">
      <img id="logo" alt="HS-V7 — Panel Salud Mental" src="/panel-html-msm/ICONS/icon-512.png" width="40" height="40" decoding="async" loading="lazy" />
      <h1 class="title">HS-V7 — Panel Salud Mental</h1>
      <span class="chip" id="onlineChip" aria-live="polite">Online</span>
      <span style="margin-left:auto"></span>
      <button id="btnCfg" aria-label="Abrir configuración" title="Configuración" style="background:#0b2033;color:var(--ink);border:1px solid #1f2f44;border-radius:10px;padding:8px 10px;cursor:pointer">⚙️</button>
    </section>

    <!-- ===== AQUI VA TU UI COMPLETA =====
         Si ya tenés tu HTML de pestañas (#ing, #alta, #pend, etc.), pegalo aquí.
         Este contenedor y el header no interfieren con tu JS existente. -->

  </main>

  <!-- ===== Config dialog / Toast placeholders (respetando tus IDs) ===== -->
  <dialog id="cfg" aria-labelledby="cfg-title">
    <h2 id="cfg-title">Configuración</h2>
    <!-- Tu contenido de configuración -->
    <form method="dialog">
      <button>cerrar</button>
    </form>
  </dialog>

  <div id="toast" class="toast" role="status" aria-live="polite" style="display:none">Listo</div>

  <!-- ===== LÓGICA / PWA ===== -->
  <script>
    // Online chip
    function setOnlineBadge(){
      const chip=document.getElementById('onlineChip');
      if(!chip) return;
      const on = navigator.onLine;
      chip.textContent = on ? 'Online' : 'Offline';
      chip.style.background = on ? '#052b33' : '#3a0210';
      chip.style.color = on ? '#8ef0c7' : '#fca5a5';
      chip.style.borderColor = on ? '#0d3b46' : '#4c0519';
    }
    window.addEventListener('online', setOnlineBadge);
    window.addEventListener('offline', setOnlineBadge);

    // Logo (permite sobreescribir vía localStorage si ya lo hacías)
    const LS = { get:(k,d=null)=>{ try{const v=localStorage.getItem(k); return v??d;}catch(_){return d;} } };
    function applyLogo(){
      const url = LS.get('HSM_LOGO_URL','/panel-html-msm/ICONS/icon-512.png');
      const el = document.getElementById('logo');
      if(!el) return;
      if(url){ el.src=url; el.hidden=false; } else el.hidden=true;
    }

    // Simple toast
    function toast(msg, ms=2000){
      const t=document.getElementById('toast'); if(!t) return;
      t.textContent=msg; t.style.display='block';
      clearTimeout(window.__toastTO);
      window.__toastTO=setTimeout(()=>t.style.display='none', ms);
    }

    // Service Worker
    (function registerSW(){
      if(!('serviceWorker' in navigator)) return;
      const scope = '/panel-html-msm/';
      navigator.serviceWorker.register(`${scope}sw.js`, { scope })
        .then(reg=>{
          // Recibir mensajes del SW
          navigator.serviceWorker.addEventListener('message', (ev)=>{
            if(ev.data && ev.data.type==='SW_ACTIVATED'){
              toast(`Actualizado (SW ${ev.data.version})`);
            }
            if(ev.data && ev.data.type==='TRY_FLUSH_PEND'){
              // si tenés función para enviar pendientes, llamala aquí
              // tryFlushPend && tryFlushPend();
            }
          });
        })
        .catch(err=>console.error('SW register error',err));
    })();

    // Accesibilidad: foco correcto tras navegación hash
    window.addEventListener('hashchange', ()=>{
      const el=document.getElementById(location.hash.slice(1));
      if(el) el.focus?.();
    });

    document.addEventListener('DOMContentLoaded', ()=>{
      setOnlineBadge();
      applyLogo();
    });
  </script>
</body>
</html>
